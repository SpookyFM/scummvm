/* ScummVM - Graphic Adventure Engine
 *
 * ScummVM is the legal property of its developers, whose names
 * are too numerous to list here. Please refer to the COPYRIGHT
 * file distributed with this source distribution.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */

#include "macs2/macs2.h"
#include "macs2/detection.h"
#include "macs2/console.h"
#include "common/scummsys.h"
#include "common/config-manager.h"
#include "common/debug.h"
#include "common/debug-channels.h"
#include "common/events.h"
#include "common/system.h"
#include "engines/util.h"
#include "graphics/palette.h"
#include "graphics/surface.h"
#include "graphics/pixelformat.h"
#include "audio/fmopl.h"

namespace Macs2 {

Macs2Engine *g_engine;

Graphics::ManagedSurface Macs2Engine::readRLEImage(int64 offs, Common::File& file)
{
	file.seek(offs);

	Graphics::ManagedSurface result = new Graphics::Surface();
	result.create(320, 200, Graphics::PixelFormat::createFormatCLUT8());
	

	// TODO: Fix length
	uint8* data = new uint8[1024];

	// TODO: Consider if it can be that the data is more than this. Maybe the tooling of the engine can make bad calls and
	// try to RLE something which would be better not RLE encoded.

	// TODO: Fix start position
	for (int y = 0; y < 200; y++) {
		uint16 length = file.readUint16LE();
		file.read(data, length);
		uint16 remainingPixels = 320;
		uint8* dataPointer = data;
		uint16 x = 0;
		while (remainingPixels > 0) {
			const uint8& value = dataPointer[0];
			dataPointer++;
			if (value != 0xF0) {
				/* if (x >= 320) {
					// TODO: This happens during loading the map
					break;
				}*/
				result.setPixel(x, y, value);
				remainingPixels--;
				x++;
			}
			else {
				// We need to decode the RLE data
				const uint8& runlength = dataPointer[0];
				dataPointer++;
				const uint8& encodedValue = dataPointer[0];
				dataPointer++;
				for (int i = 0; i < runlength; i++) {
					/* if (x >= 320) {
						// TODO: This happens for loading the map - maybe this code is a bit different?
						break;
					} */
					result.setPixel(x++, y, encodedValue);
				}
				remainingPixels -= runlength;
			}
		}
	}

	return result;
}

int previewNumFrames(int64 offs, Common::File& file) {
	file.seek(offs);
	int64 numBytes = file.readUint32LE();
	// byte* data = new byte[numBytes];
	// file.read(data, numBytes);
	// TODO: Extract the frames
	// Skip ahead to the start of the first frame
	file.seek(20, SEEK_CUR);
	numBytes -= 20;
	int numFrames = 0;
	while (numBytes > 0) {
		file.seek(6, SEEK_CUR);
		numBytes -= 6;
		uint16_t x = file.readUint16LE();
		uint16_t y = file.readUint16LE();
		file.seek(x * y, SEEK_CUR);
		numBytes -= 4 + 4 + x * y;
		numFrames++;
	}
	file.seek(offs);
	return numFrames;
}

void Macs2Engine::readBackgroundAnimations(int64 offs, Common::File& file)
{
	// Load number of frames
	// Skip to width and height, skip data
	// Do until we hit the amount of bytes to load
	// TODO: Later on figure out the actual amount of data



	// TODO: Figure out the skipped data
	file.seek(offs);
	_numBackgroundAnimations = file.readUint16LE();
	_backgroundAnimations = new BackgroundAnimation[_numBackgroundAnimations];
	for (int i = 0; i < _numBackgroundAnimations; i++) {
		BackgroundAnimation &current = _backgroundAnimations[i];
		current.X = file.readUint16LE();
		current.Y = file.readUint16LE();
		// current.numFrames = previewNumFrames(file.pos(), file);
		uint32 numBytes = file.readUint32LE();
		// Skip to the intermediary data
		file.seek(10, SEEK_CUR);
		uint16 nextNumBytes = file.readUint16LE();
		file.seek(nextNumBytes, SEEK_CUR);


		// int64 endPos = file.pos() + numBytes;
		// byte* data = new byte[numBytes];
		// file.read(data, numBytes);
		// TODO: Extract the frames
		// Skip ahead to the number of frames (?)
		// file.seek(20, SEEK_CUR);
		current.numFrames = file.readUint16LE();
		current.Frames = new AnimFrame[current.numFrames];
		for (int j = 0; j < current.numFrames; j++) {
			// Skip to width and height
			file.seek(6, SEEK_CUR);
			current.Frames[j].ReadFromeFile(file);
		}
		// TODO: This allows us to skip over a faulty implementation, but
		// probably missing some valid data or loading wrong data
		// file.seek(endPos);
		// TODO: Figure out the trailing values?
		uint16 unknown1 = file.readUint16LE();
		uint16 unknown2 = file.readByte();
		uint16 unknown3 = file.readByte();
	}
	/*
	# This is the number of items overall
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:50f5, caller 01e7:271d, values: 0800
# Position maybe?
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:50f7, caller 01e7:2765, values: ac00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:50f9, caller 01e7:277e, values: 6e00
# Number of bytes to read
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:50fb, caller 01e7:2797, values: ec0e0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 3820 to address: 0427:0000, caller 01e7:2800, values: 0100010000000000000006000b03010c030402000000000001002d002a005da1a15d5da1a1536a6aa16a6a9c9c9e6a9c9c9c9e6a9e6a9e9c9c9c9e6a9ca7b27ba76f4f5a8d8d8d8d8d5a4fa1a1a1a1a15d5d5da7a7a15da16a6a6a6aa1a1a1a19ea16a9c9c9e9e9ea1a77bb2b2a7525252526f674f5a8d8d5da7a79797b2b2b2b27b97b2b27b975da16aa1a1a1a15d9ea19e5da7a7b2b2b2b2b2b2525252525252526f6f6f9db2b2b2b265b2b265b29db2b2b265b265a7a19c6a5d5da16aa77bb2b2b2b2b2b2b2b252526f6f6f525252526f9d2065657a7a7a7a7a7a657a7ab29db29db2b2a79ea1a1a77b7bb2b2b2b2b2b27b7bb252526f52526f6f52526f9db2b27a65657a7ab29d65b2b2b2b2b2b2b2b2b27b7b7bb2b27a7a7a7a7a65207a659d5252525252525252526f7a7a7a7a7a44447a447a9d9d7ab2b2b2b2b27bb2b220b29db265209db2b29d9d9d2065526f707070525252526f7a65657a209d7a7a7a209db2b2b2977bb2b29d7a657a7ab2b2b2b2b2b2b29d65657a7a526f707070707052526f9db29d449d9d979db2b29d9d449d9d9d7a9d447a7a7a9d7a7a7a44657a44447a44447a526f707070707052526f449d9d7a9d4444447a4444447a7a447a7a7a444444447a9d7a4444447a447a7a447a7a526f707070707052526f9d9d444444447a444444447a7a7a7a7a44447a7a7a44447a447a7a7a7a447a7a7a7a7a526f707070707052526f9d9d9d9d44444444449d449d447a447a7a7a7a447a544444447a4444449d9d979d447a526f707070707052526f696926acacacb6abb69090919d9d97449db2979797b29d977a447a447a7a7a7a7a7a7a526f707070707052526f777777777777777777779b373777379b373777276973915b9d97a7a797a797979d7a7a526f707070707052526f818948818194818181894889484889ac9a8f777777777777377777777727692769598f526f707070707052526f8181a988a988a9888888b388888888881988b3b3b388b388b3888888888848896c6c6c526f707070707052526f8383638181819481818194636c6c6c6c6c6c6c6c6c6c94818181948181819481818194526f707070707052526f88888888838888b381be81b388b3b3b3b3b3b3b3b3b3b31988b3b3b3b388a9b38888a9526f707070707052526f8989894040638981be41896389b3b3b3b36cb3b3b3b3b3b3b3b36cb3b3b388b3b34889526f707070707052526f6c6c6c6c6c6c6c9481894889486c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c81818194be6c526f707070707052526fa989a9a919b319a94088b3198888888819b31919b319884019a988b363b381be811919526f707070707052526fa9194040b38989898989b3b3b3198819191919884040404040a963a9a981be4189a683526f707070707052526f6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c896c6c948189488989526f707070707052526f81484848489863b381be81896388888889989898839898989898989898988888888888526f707070707052526f989898986398a981be4163b3888888888888888888888888a9a9a68383888888888888526f707070707052526f89818148898989948189486c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c89b3526f707070707052526fa6a9a6a6a6a6a9a6a6a6a6a983a6a9a9a9a91998888989a94019888888631919899889526f707070707052526fa9a9a919a9404040a919a9a9a9a9a9a94040404040404040191919634019a9a9a9a9a952526f5270707052526fa089a9a9a940a9a98989898989898989898989899889a94019a9a998a9a9a9a9a9a9a9525252526f527052526f6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c526f525252525252526f9889988989989898898180818998a6838383a9a683a68383a9a9838383a98319198383525252526f525252526f98899898989898989881be81a9a6a983838383a683a98383a6a983a9838383196ca8527070525252526f52526f484898989898989848be41a998a9a9a683a68383838383838383a6838383a831af525cb470707052525252526f318948489898488981be8148489898a983a6a683838383838883836ca8678c5c76b4b4b4b4b47070705252526f41a0a8a0a0a8a8a0a0a0a0a0a0a0a0a0a0a0bea0a0a0a0a0a0a0678c525c76767676767676767676707052526f814141414141414141818d41818d41418d41948d8d41a8a0678c5c76b4767676767676767676767676b470705241818141414194414141418d8d8d949494ba8dba417131af8c7fb4b4b4b4b4b4b4b4b47676767676767676767641418d414141414141418dbababa949494949494a067af8c7f76b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b43131a0a071bea0a0a0a0a0a0a0a0a0a0a0a0a0a0a0af8c9276b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4be81948d8d4141816363419494949494949494a067af527f76b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b494948d944141414194719494949494949494949431af8cb876b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b441419494419441814194418181418181818d8d8d6367af927fb4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b40000000001002d002a005da1a15d5da1a1536a6aa16a6a9c9c9e6a9c9c9c9e6a9e6a9e9c9c9c9e6a9ca7b27ba76f8d8d8d8d8d8d8d8d4fa1a1a1a1a15d5d5da7a7a15da16a6a6a6aa1a1a1a19ea16a9c9c9e9e9ea1a77bb2b2a752525252524f8d8d8d8d5da7a79797b2b2b2b27b97b2b27b975da16aa1a1a1a15d9ea19e5da7a7b2b2b2b2b2b25270700b52525252526f9db2b2b2b265b2b265b29db2b2b265b265a7a19c6a5d5da16aa77bb2b2b2b2b2b2b2b25270700b0b0b0b0b526f9d2065657a7a7a7a7a7a657a7ab29db29db2b2a79ea1a1a77b7bb2b2b2b2b2b27b7bb25270700b700b0b0b0b6f9db2b27a65657a7ab29d65b2b2b2b2b2b2b2b2b27b7b7bb2b27a7a7a7a7a65207a659d5270700b0b0b0b0b0b6f7a7a7a7a7a44447a447a9d9d7ab2b2b2b2b27bb2b220b29db265209db2b29d9d9d20655270700b700b0b0b0b6f7a65657a209d7a7a7a209db2b2b2977bb2b29d7a657a7ab2b2b2b2b2b2b29d65657a7a5270700b0b0b0b0b0b6f9db29d449d9d979db2b29d9d449d9d9d7a9d447a7a7a9d7a7a7a44657a44447a44447a5270700b700b0b0b0b6f449d9d7a9d4444447a4444447a7a447a7a7a444444447a9d7a4444447a447a7a447a7a5270700b0b0b0b0b0b6f9d9d444444447a444444447a7a7a7a7a44447a7a7a44447a447a7a7a7a447a7a7a7a7a5270700b700b0b0b0b6f9d9d9d9d44444444449d449d447a447a7a7a7a447a544444447a4444449d9d979d447a5270700b0b0b0b0b0b6f696926acacacb6abb69090919d9d97449db2979797b29d977a447a447a7a7a7a7a7a7a5270700b700b0b0b0b6f777777777777777777779b373777379b373777276973915b9d97a7a797a797979d7a7a5270700b0b0b0b0b0b6f818948818194818181894889484889ac9a8f777777777777377777777727692769598f5270700b700b0b0b0b6f8181a988a988a9888888b388888888881988b3b3b388b388b3888888888848896c6c6c5270700b0b0b0b0b0b6f8383638181819481818194636c6c6c6c6c6c6c6c6c6c948181819481818194818181945270700b700b0b0b0b6f88888888838888b381be81b388b3b3b3b3b3b3b3b3b3b31988b3b3b3b388a9b38888a95270700b0b0b0b0b0b6f8989894040638981be41896389b3b3b3b36cb3b3b3b3b3b3b3b36cb3b3b388b3b348895270700b700b0b0b0b6f6c6c6c6c6c6c6c9481894889486c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c81818194be6c5270700b0b0b0b0b0b6fa989a9a919b319a94088b3198888888819b31919b319884019a988b363b381be8119195270700b700b0b0b0b6fa9194040b38989898989b3b3b3198819191919884040404040a963a9a981be4189a6835270700b0b0b0b0b0b6f6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c896c6c9481894889895270700b700b0b0b0b6f81484848489863b381be818963888888899898988398989898989898989888888888885270700b0b0b0b0b0b6f989898986398a981be4163b3888888888888888888888888a9a9a683838888888888885270700b700b0b0b0b6f89818148898989948189486c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c89b35270700b0b0b0b0b0b6fa6a9a6a6a6a6a9a6a6a6a6a983a6a9a9a9a91998888989a940198888886319198998895270700b700b0b0b0b6fa9a9a919a9404040a919a9a9a9a9a9a94040404040404040191919634019a9a9a9a9a95270700b0b0b0b0b0b6fa0a06770525252525252525252525252525252525252525252525252525252525252525270700b0b0b0b0b0b6f89675270707052525252525252526f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f52525252525270707070700b0b6f986752b4707070525252527070707070707070707070707070707070707070706f52525252525270707070706f98486752b4707070525252525270707070707070707070707070707070707070706f525252526f52527070706f4863485252b4b4707070525252525270707070707070707070707070707070707070706f52525252525270706f31a0a8675252b4b47070705252525252525252525252525252525252525252525252525252525252525252526f414141a067af52b4b4b4706f6262626262626262626262626262626262626262626262626262626262626f526f818181414167af52b4b4b46f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f525241418d41414167af52b4b4b4b470707070707070707070707070707070707070707070707070707070707070704141414141414167af5252b4b4b4b4b4b4b4b4b4b4b4b4b4b476b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4313131313131a0a031676767afafaf525252525252b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4be81948d8d41418163634194949494afafafafaf525252b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b494948d944141414194719494949494949494949431af8cb876b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b441419494419441814194418181418181818d8d8d6367af927fb4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4b4
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5103, caller 01e7:2819, values: 0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5105, caller 01e7:2832, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5106, caller 01e7:284b, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5107, caller 01e7:2765, values: 2100
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5109, caller 01e7:277e, values: 6600
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:510b, caller 01e7:2797, values: ba040000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1210 to address: 042f:0000, caller 01e7:2800, values: 0100010000000000000006000b03010c030402000000000001000d002d009c9c53bbbbad9c53535353155379bb3f2e2e122e3f2e3f3f3fa1a47c2e07090909a30909a31279a43fa3a3585858b4b4b47678b4463fa3a3a3a3a3a358a3a312b464a3a3955353535324795f79a364a3a3bba705a1a70509a3bcb4a4a3a37e5da7a17e05017979b4a4a3a37e4305a105a70979955846a3a3aea18b9c8b2412a33f58a4a3a3ae24249c9c9c12a33f58955fa3ae248b9c9c9c12a37958bb398574a1246a9cbc1b58795879a358ae248b539c9c2e5879587c58b4ae24a7539c6a12b495b03fa3587e24a19c9c6a12b0a3353fa3580f24a19c538b3f384c324ea3587e248b537469bb3885b12ea3587e8b8b919b37bb384cb14eb44c057e751a1a37bb3885b13fb4b073779b1a1a9b79b1b4352eb4b88f9b4d4d4d9b95b14cb14635358f4d4d4d4d1a7938b435bc35358f4d4d4d4d4da332b435bc3835664d4d4d4d8fb435b4b18b38326666b6b6b666b1354c352738b1b5b1b13535353532923527383535b138b1383838354cb169353838383832383838384cb169b13832353535b138353885b169b1b13835b13538b13532b4b16935383835b13538383538b4b1693838b135b13538383538b4b18fb13832b1b135383835b1b4b18fb138b1b13535383835b1b4b169b1383838353538383535b0b18fb1b138383535383235b1b4b18fb1383838b1353838b135b0b18f383838b1b13538b13535b0b18f35353838b13532383535b4b18f35353838b1353535b8b0a35f693535383835b45f5f5f858caf26b1b1b05f855caf6767676767b3b49267676767676767678d8d678d8d8d8d8d8d8d8dbaba94940000000001000d002d009c9c53bbbbad9c53535353155379bb3f2e2e122e3f2e3f3f3fa1a47c2e07090909a30909a31279a4e0e0e0e0e0e0e0e0e0e078b446e0e0e0e0e0e0e0e0e0e012b464e0e0e0e0e0e0e0e0e0e079a364e0e0e0e0e0e0e0e0e0e0bcb4a4e0e0e0e0e0e0e0e0e0e079b4a4e0e0e0e0e0e0e0e0e0e0955846e0e0e0e0e0e0e0e0e0e03f58a4e0e0e0e0e0e0e0e0e0e03f5895e0e0e0e0e0e0e0e0e0e07958bbe0e0e0e0e0e0e0e0e0e0795879e0e0e0e0e0e0e0e0e0e079587ce0e0e0e0e0e0e0e0e0e095b03fe0e0e0e0e0e0e0e0e0e0a3353fe0e0e0e0e0e0e0e0e0e04c324ee0e0e0e0e0e0e0e0e0e085b12ee0e0e0e0e0e0e0e0e0e04cb14ee0e0e0e0e0e0e0e0e0e085b13fe0e0e0e0e0e0e0e0e0e0b4352ee0e0e0e0e0e0e0e0e0e04cb146e0e0e0e0e0e0e0e0e0e0b435bce0e0e0e0e0e0e0e0e0e0b435bce0e0e0e0e0e0e0e0e0e0b4b18be0e0e0e0e0e0e0e0e0e04c3527e0e0e0e0e0e0e0e0e0e0923527e0e0e0e0e0e0e0e0e0e04cb169e0e0e0e0e0e0e0e0e0e04cb169e0e0e0e0e0e0e0e0e0e085b169e0e0e0e0e0e0e0e0e0e0b4b169e0e0e0e0e0e0e0e0e0e0b4b169e0e0e0e0e0e0e0e0e0e0b4b18fe0e0e0e0e0e0e0e0e0e0b4b18fe0e0e0e0e0e0e0e0e0e0b4b169e0e0e0e0e0e0e0e0e0e0b0b169e0e0e0e0e0e0e0e0e0e0b4b127e0e0e0e0e0e0e0e0e0e0b0b127e0e0e0e0e0e0e0e08585b0b121e0e08585851818181818b4b169851818181818185c5c8c8c5f69185c5c5c5c5c5c8c8c8c8caf265c5c8c8c8c8caf6ca9a9a9bab38c8ca863a9a9a9baa9babaa967a9a9a9a9a9a9a9a9baba9494
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5113, caller 01e7:2819, values: 0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5115, caller 01e7:2832, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5116, caller 01e7:284b, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5117, caller 01e7:2765, values: 4100
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5119, caller 01e7:277e, values: 6500
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:511b, caller 01e7:2797, values: c8070000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1992 to address: 0437:0000, caller 01e7:2800, values: 010001000000000000000a000b0b0c0c0d0d0c0c0301030000000000010026001100bcab1345135b8a8a99999999993a8ebb7453748a99998a8a99b5b59999999999678080808080b68ab5b5b5b5b5b5b5b5b5b5b5b58ebb539c3ab53ab5b53a3a3a3a3a3ab5b531676767af67529a99b5b5b5b5b5b5b5b5b5b5b53a8e5fb553b53ab9b9b93a3a3a3ab9b98eb93131af62673e929ab5b5b5b53a3ab9b9b9b9b9b98e535f99a7a1a1a143242424a1a1a1a1a1af80afaf6262b7929ab53a8eadad30304aa15da7a7a7a7499943a7a7a7a7a15d5d6a5d6aa19e80b7afb73eb73e528fa7a7a7a7a7a7a7a7a7a7a7a7a7a749b543a7a7a7a7a7a7a75da7a7a78b31626262623e3e528f97a7a7a7a7a7a7a7a75d5da7a75d5f9924a7a75d5da1a1a1a1a15da7604fb74f6262b73eb88f97a797a7a7a7a7a7a75da7a15d5d5f60245da1a1a1a7a75da7a7b2207d6f6f8c7fb8b8b4728f9d447a9d9d9d9797a7a7a7a7a75d5f60245da7a7977a7a7a7a9d9d9d8bb7afb7b7b7b73e928f9d9d7a7a7a7a7a44447a7a7a9d9d5fb5249d9d447a7a7a7a9d9db29d745a3e6262b7623e52697a449d7a7a447a447a7a7a7a7a7a7960439d7a9d7a447a7ab29d9d9d604f3e3e4f3eb7af8c8f44444444447a4444447a7a7a7a7aa37e439db29d9d9d9d9d9d979d9760b74f626262623e8c8f449d447a7a9d7a7a44447a7a7a445f7e24b27a9db27bb2b2979797a77d3e4f62624f4faf6f6944977a9d7a7a447a7a657a7a7a7a5f15249d7a7a9d97979d97747e608c6f6262b73e3eb76f8f97977a7a7a7a7a4444449d9d9db25f1543318071a8a8a8a0a0a8a0a86752b76262623e6f8c8f97977a44447a444444449d9d9d975f7e4380a8a8a0a8a0a8a0a0a867927f7fb8b8b8b8b87f8f44979d9d9d9d979d9d9d9d979799967424623e3e8c3e624f62623e8c52b8767f76b8b8b8b800000000010026001100bcab1345135b8a8a99999999993a8ebb7453748a99998a8a99b5b59999999999678080808080b68ab5b5b5b5b5b5b5b5b5b5b5b58ebb539c3ab53ab5b53a3a3a3a3a3ab5b531676767af67529a99b5b5b5b5b5b5b5b5b5b5b53a8e5fb553b5aeb9b9b93a3a3a3ab9b98eb93131af62673e929ab5b5b5b53a3ab9b9b9b9b9b98e535f99a7a1a7a143242424a1a1a1a1a1af80afaf6262b7929ab53a8eadad30304aa15da7a7a7a7499943a7a7a7a7a15d5d6a5d6aa19e80b7afb73eb73e528fa7a7a7a7a7a7a7a7a7a7a7a7a7a749b543a7a7a7a7a7a7a75da7a7a78b31626262623e3e528f97a7a7a7a7a7a7a7a75d5da7a75d5f9924a7a75d5da1a1a1a1a15da7604fb74f6262b73eb88f97a7a7a7a7a7a7a7a7a75da7a15d5f60245da1a1a1a7a75da7a7b2207d6f6f8c7fb8b8b4728f9d447a9d9d9797a7a7a7a7a75d5d5f60245da7a7977a7a7a7a9d9d9d8bb7afb7b7b7b73e928f9d9d7a7a7a7a7a44447a7a7a9d9d5fb5249d9d447a7a7a7a9d9db29d745a3e6262b7623e52697a449d7a7a447a447a7a7a7a7a7a7960439d7a9d7a447a7ab29d9d9d604f3e3e4f3eb7af8c8f44444444447a4444447a7a7a7a7aa37e439db29d9d9d9d9d9d979d9760b74f626262623e8c8f449d447a7a9d7a7a44447a7a7a445f7e24b27a9db27bb2b2979797a77d3e4f62624f4faf6f6944977a9d7a7a447a7a657a7a7a7a5f15249d7a7a9d97979d97747e608c6f6262b73e3eb76f8f97977a7a7a7a7a4444449d9d9db25f1543318071a8a8a8a0a0a8a0a86752b76262623e6f8c8f97977a44447a444444449d9d9d975f7e4380a8a8a0a8a0a8a0a0a867927f7fb8b8b8b8b87f8f44979d9d9d9d979d9d9d9d979799967424623e3e8c3e624f62623e8c52b8767f76b8b8b8b800000000010026001100bcab1345135b8a8a99999999993a8ebb7453748a99998a8a99b5b59999999999678080808080b68ab5b5b5b5b5b5b5b5b5b5b5b58ebb539c3ab53ab5b53a3a3a3a3a3ab5b531676767af67529a99b5b5b5b5b5b5b5b5b5b5b53a8e5fb553b5aeb9b9b93a3a3a3ab9b98eb93131af62673e929ab5b5b5b53a3ab9b9b9b9b9b98e535f99a7a1a7a143242424a1a1a1a1a1af80afaf6262b7929ab53a8eadad30304aa15da7a7a7a7499943a7a7a7a7a15d5d6a5d6aa19e80b7afb73eb73e528fa7a7a7a7a7a7a7a7a7a7a7a7a7a749b543a7a7a7a7a7a75da7a7a7a78b31626262623e3e528f97a7a7a7a7a7a7a7a75d5da7a75d5f9924a7a75d5da1a1a1a1a15da7604fb74f6262b73eb88f97a7a7a7a7a7a7a7a75da7a15d5d5f60245d5da1a1a1a7a75da7a7b27d6f6f8c7fb8b8b4728f9d447a9d9d9d9797a7a7a7a7a75d5f60245da7a7977a7a7a7a9d9d9d8bb7afb7b7b7b73e928f9d9d7a7a7a7a7a44447a7a7a9d9d5fb5249d9d447a7a7a7a9d9db29d745a3e6262b7623e52697a449d7a7a447a447a7a7a7a7a7a7960439d7a9d7a447a7ab29d9d9d604f3e3e4f3eb7af8c8f44444444447a4444447a7a7a7a7aa37e439db29d9d9d9d9d9d979d9760b74f626262623e8c8f449d447a7a9d7a7a44447a7a7a445f7e24b27a9db27bb2b2979797a77d3e4f62624f4faf6f6944977a9d7a7a447a7a657a7a7a7a5f15249d7a7a9d97979d97747e608c6f6262b73e3eb76f8f97977a7a7a7a7a4444449d9d9db25f1543318071a8a8a8a0a0a8a0a86752b76262623e6f8c8f97977a44447a444444449d9d9d975f7e4380a8a8a0a8a0a8a0a0a867927f7fb8b8b8b8b87f8f44979d9d9d9d979d9d9d9d979799967424623e3e8c3e624f62623e8c52b8767f76b8b8b8b8
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5123, caller 01e7:2819, values: 0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5125, caller 01e7:2832, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5126, caller 01e7:284b, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5127, caller 01e7:2765, values: 7600
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5129, caller 01e7:277e, values: 6800
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:512b, caller 01e7:2797, values: fa0e0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 3834 to address: 043f:0000, caller 01e7:2800, values: 010001000000000000000a000b0b0c0c0d0d0c0c030103000000000001005a000e00b6a15d5da7a75d5da7a7a7a7a7a75da75da7a7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a1a16a9e6a9ca19e6aa16aa1a1a1a16aa1a1a7a7a7a7a7a7a75d5d055d5d5d5da1a1a75da7a79aa75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a797a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a15d5d5d5da1a1a75d5d5da16a6a6a9c9c6a6aa1a1a1a1a19ea1a1a1a1a1a15da1a1a75da7b6a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a79797a79d97979797979797a7a7a7a7a7a7a7a7a7a75d5d5da1a1a19ca19e9e9ea19ea1a1a19e9ea19e9ea19c6a6a9c6a6a74a7a7a75d5d5d5d5d5d5da15da7a75d5d5d5d5d5d5da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a75da15d5da1a15d5d5d5da75da1a1a1a19ea1a1a1a17ea7a75da15d5d5d5d5da7a7a75da7a75da75da75da7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a7a7a7a7a7a75d5da1a7a75da1a19ea1a19ea1a15da1a15da19e6aa1a19ea1a15da1a1a1a19ea1a1a19e66449d447aa7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a75da75da7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da15d5d5d5da1a1a1a1a15da1a16a5da1a15da7a75d6aa1a16aa16a9ca1a16a9e9e9e6ab69d447a7a4444444444447a447a7a979797a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a7a7a75da15d5da15da15d5d5d5da15d5d5d5da1a15d5da1a1536a6aa16a6a9c9c9e6a9c9c9c9e6a9e6a9e9c9c9c9e6a9ca7b27ba76f669d9d7a7a444444444444447a447a7a7a447a7a7a7a9da7a7a7a7a7a7a77a7a449d7a9d7a44449d979d97a7a7a7a7a75da7a1a1a1a1a1a1a1a1a15d5d5da7a7a15da16a6a6a6aa1a1a1a19ea16a9c9c9e9e9ea1a77bb2b2a752ae9d4444447a7a7a7a547a7a7a7a7a7a7a7a7a7a7a7a447a7a444444449d7a449d449d7a9d9db29d97b29d9db2b2b2b2979797a7a75d5da7a79797b2b2b2b27b97b2b27b975da16aa1a1a1a15d9ea19e5da7a7b2b2b2b2b2b252a79d7a7a7a7a447a7a547a547a7a7a7a7a7a7a7a7a7a44447a657a7a7a447a7a7a9d9d9d9d9d9d9d9d9db265b29d7a9d7a657a659d9d9db2b2b2b265b2b265b29db2b2b265b265a7a19c6a5d5da16aa77bb2b2b2b2b2b2b2b252716c66979d7a7a7a7a7a7a44444444449d9d7a7a7a7a7a6544449d209d209d65979d65b27a7a7a9d7ab26565b2b2b2b27bb2b2b2b2659d2065657a7a7a7a7a7a657a7ab29db29db2b2a79ea1a1a77b7bb2b2b2b2b2b27b7bb252be8383ac7a7a7a7a7a5454547a7a447a44447a44447a9d447a7a447a9d44447a7a7a9d7a7a7a9d7a449d7ab29d659db2b2b2b2b2b29d9db2b27a65657a7ab29d65b2b2b2b2b2b2b2b2b27b7b7bb2b27a7a7a7a7a65207a659d52a6837777447a447a7aa5447a447a7a7a7a7a7a7a7a7a7a7a7a7a444444447a447a7a44447a444444447a4444447a44a5447a447a7a447a7a7a7a7a44447a447a9d9d7ab2b2b2b2b27bb2b220b29db265209db2b29d9d9d20655298838877974444447a447a7a7a7a7a547a5454547aa57a447a7a447a7a7a44447a7a9d9d657a7a9d7a9d7a657a7a9d657a9d9d7a7a7a7a65657a209d7a7a7a209db2b2b2977bb2b29d7a657a7ab2b2b2b2b2b2b29d65657a7a520000000001005a000e00b6a15d5da7a75d5da7a7a7a7a7a75da75da7a7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a1a16a9e6a9ca19e6aa16aa1a1a1a16aa1a1a7a7a7a7a7a7a75d5d055d5d5d5da1a1a75da7a79aa75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a797a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a15d5d5d5da1a1a75d5d5da16a6a6a9c9c6a6aa1a1a1a1a19ea1a1a1a1a1a15da1a1a75da7b6a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a79797a79d97979797979797a7a7a7a7a7a7a7a7a7a75d5d5da1a1a19ca19e9e9ea19ea1a1a19e9ea19e9ea19c6a6a9c6a6a74a7a75d5d5d5d5d5d5da15da7a75d5d5d5d5d5d5da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a75da15d5da1a15d5d5d5da75da1a1a1a19ea1a1a1a17ea7a75da15d5d5d5d5da7a7a75da7a75da75da75da7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a7a7a7a7a75d5da1a1a75da1a19ea1a1a19ea1a15da1a15da19e6aa1a19ea1a15da1a1a1a19ea1a1a19e66449d447aa7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a75da75da7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da15d5d5d5da1a1a1a1a15da1a16a5da1a15da7a75d6aa1a16aa16a9ca1a16a9e9e9e6ab69d447a7a4444444444447a447a7a979797a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a7a7a7a75da15d5da15da15d5d5d5da15d5d5d5da1a15d5da1a1536a6aa16a6a9c9c9e6a9c9c9c9e6a9e6a9e9c9c9c9e6a9ca77ba76f669d9d7a7a444444444444447a447a7a447a7a7a7a9da7a7a7a7a7a7a77a7a449d9d7a9d7a44449d979d97a7a7a7a7a75da7a1a1a1a1a1a1a1a1a15d5d5da7a7a15da16a6a6a6aa1a1a1a19ea16a9c9c9e9e9ea1a77bb2b2a752ae9d4444447a7a7a7a547a7a7a7a7a7a7a7a7a7a7a7a447a7a444444449d7a449d449d7a9d9d9d97b29d9db2b2b2b2979797a7a75d5da7a79797b2b2b2b27b97b2b27b975da16aa1a1a1a15d9ea19e5da7a7b2b2b2b2b2b2b252a79d7a7a7a7a447a7a547a547a7a7a7a7a7a7a7a7a7a44447a657a7a7a447a7a7a9d9d9d9d9d9d9d9d9db265b29d7a9d7a657a659d9d9db2b2b2b265b2b265b29db2b2b265b265a7a19c6a5d5da16aa77bb2b2b2b2b2b2b2b252716c66979d7a7a7a7a7a7a44444444449d9d7a7a7a7a7a6544449d209d209d65979d65b27a7a7a9d7ab26565b2b2b2b27b7bb2b2b2b2659d2065657a7a7a7a7a7a657a7ab29db29db2b2a79ea1a1a77b7bb2b2b2b2b27b7bb252be8383ac7a7a7a7a7a5454547a7a447a44447a44447a9d447a7a447a9d44447a7a7a9d7a7a7a9d7a449d7ab29d659db2b2b2b2b2b29d9db2b27a65657a7ab29d65b2b2b2b2b2b2b2b2b27b7b7bb2b27a7a7a7a7a65207a659d52a6837777447a447a7aa5447a447a7a7a7a7a7a7a7a7a7a7a7a7a444444447a447a7a44447a444444447a4444447a44a5447a447a7a447a7a7a7a7a44447a447a9d9d7ab2b2b2b2b27bb2b220b29db265209db2b29d9d9d20655298838877974444447a447a7a7a7a7a547a5454547aa57a447a7a447a7a7a44447a7a9d9d657a7a9d7a9d7a657a7a9d657a9d9d7a7a7a7a65657a209d7a7a7a209db2b2b2977bb2b29d7a657a7ab2b2b2b2b2b2b29d65657a7a520000000001005a000e00b6a15d5da7a75d5da7a7a7a7a7a75da75da7a7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a1a16a9e6a9ca19e6aa16aa1a1a1a16aa1a1a7a7a7a7a7a7a75d5d055d5d5d5da1a1a75da7a79aa75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a797a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a15d5d5d5da1a1a75d5d5da16a6a6a9c9c6a6aa1a1a1a1a19ea1a1a1a1a1a15da1a1a75da7b6a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a79797a79d9797979797979797a7a7a7a7a7a7a7a7a7a75d5d5da1a1a19ca19e9e9ea19ea1a1a19e9ea19e9ea19c6a9c6a6a74a7a7a75d5d5d5d5d5d5d5da15da7a75d5d5d5d5d5d5da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a75da15d5da1a15d5d5d5da75da1a1a1a19ea1a1a1a17ea7a75da15d5d5d5d5da7a7a75da7a75da75da75da7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a7a7a7a7a75d5da1a7a15da1a19ea1a1a19ea1a15da1a15da19e6aa1a19ea1a15da1a1a1a19ea1a1a1a19e66449d447aa7a7a7a7a7a7a7a7a7a7a7a7a7a75da7a7a7a7a7a75da75da7a75da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75da15d5d5d5da1a1a1a1a15da1a16a5da1a15da7a75d6aa1a16aa16a9ca1a16a9e9e9e6ab69d447a7a4444444444447a447a7a979797a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7a7a7a75da15d5da15da15d5d5d5da15d5d5d5da1a15d5da1a1536a6aa16a6a9c9c9e6a9c9c9c9e6a9e6a9e9c9c9c9e6a9c6ab27ba76f669d9d7a7a444444444444447a447a7a7a447a7a7a7a7a9da7a7a7a7a7a77a7a449d7a9d9d7a44449d979d97a7a7a7a7a75da7a1a1a1a1a1a1a1a1a15d5d5da7a7a15da16a6a6a6aa1a1a1a19ea16a9c9c9e9e9ea1a77bb2a752ae9d4444447a7a7a7a547a7a7a7a7a7a7a7a7a7a7a7a447a7a444444449d7a449d449d7a9d9db29d97b29d9db2b2b2b2979797a7a75d5da7a79797b2b2b2b27b97b2b27b975da16aa1a1a1a15d9ea19e5da7a7b2b2b2b2b2b252a79d7a7a7a7a447a7a547a547a7a7a7a7a7a7a7a7a7a44447a657a7a7a447a7a7a9d9d9d9d9d9d9d9db265b29d7a9d7a657a659d9d9db2b2b2b265b2b265b29db2b2b265b265a7a19c6a5d5da16aa77bb2b2b2b2b2b2b2b2b252716c66979d7a7a7a7a7a7a44444444449d9d7a7a7a7a7a6544449d209d209d65979d65b27a7a7a9d7ab26565b2b2b2b27bb2b2b2b2659d2065657a7a7a7a7a7a657a7ab29db29db2b2a79ea1a1a77b7bb2b2b2b2b2b27b7bb252be8383ac7a7a7a7a7a5454547a7a447a44447a44447a9d447a7a447a9d44447a7a7a9d7a7a7a9d7a449d7ab29d659db2b2b2b2b2b29d9db2b27a65657a7ab29d65b2b2b2b2b2b2b2b2b27b7b7bb2b27a7a7a7a7a65207a659d52a6837777447a447a7aa5447a447a7a7a7a7a7a7a7a7a7a7a7a7a444444447a447a7a44447a444444447a4444447a44a5447a447a7a447a7a7a7a7a44447a447a9d9d7ab2b2b2b2b27bb2b220b29db265209db2b29d9d9d20655298838877974444447a447a7a7a7a7a547a5454547aa57a447a7a447a7a7a44447a7a9d9d657a7a9d7a9d7a657a7a9d657a9d9d7a7a7a7a65657a209d7a7a7a209db2b2b2977bb2b29d7a657a7ab2b2b2b2b2b2b29d65657a7a52
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5133, caller 01e7:2819, values: 0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5135, caller 01e7:2832, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5136, caller 01e7:284b, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5137, caller 01e7:2765, values: d100
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5139, caller 01e7:277e, values: 6800
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:513b, caller 01e7:2797, values: 84030000
DOS file read from file 5 (RESOURCE.MCS) bytes read 900 to address: 0507:05fc, caller 01e7:2800, values: 010001000000000000000a000b0b0c0c0d0d0c0c030103000000000001002f0006005da7a7a7a75d5d5d5d5d5da75d5da7a7a1a1a7a7a7a7a7a75d5d6aa19cbcbcbcbcbcbcbcbbbbbbbbbbbcad9c9c30535da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75d5d5da7a7a15da15da7a75da7a7a7a7a797a7a7a75d5da1a1a1a1a1a16aa1a1a1a15d5d5da75d5d5d5da75d5d5da1a1a1a1a16aa16aa1a1a1a1a1a1a1a1a1a15d5d5d5d5d5da15d5da76a6a6a6a6a9c9c9ca1a1a15d5d5d5d5d5d5d5d5da1a16a9c9e6a9c9c9c6a6a9c9c9c9c9c9c9c9c9c9c9c9c6a9e9e9ea19c6a9ea1a16aa16a9c6a6a9c9ca1a19c9c9ca19e9ea19ebb9c9c9c9c9c9cbcbcbcbcbcbcbc9c9cbc9c6a6a6aa19e6a6a9c6a9c9c9c9c9c9c9c9c9c9c9c9c9c9c6a9c9c9c9c9c9c9c9c9c9c9c9cbc9c9cbcbc9cbc9cbc9c9cbc9c9c6aa10000000001002f0006005da7a7a7a75d5d5d5d5d5da75d5da7a7a1a1a7a7a7a7a7a75d5d6aa19cbcbcbcbcbcbcbcbbbbbbbbbbbcad9c9c30535da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75d5d5da7a7a15da15da7a75da7a7a7a7a797a7a7a75d5da1a1a1a1a16aa1a1a1a15d5d5da75d5d5d5da75d5d5da1a1a1a1a16aa16aa1a1a1a1a1a1a1a1a1a15d5d5d5d5d5da15d5da7a76a6a6a6a6a9c9c9ca1a1a15d5d5d5d5d5d5d5d5da1a16a9c9e6a9c9c9c6a6a9c9c9c9c9c9c9c9c9c9c9c9c6a9e9e9ea19c6a9ea1a1a16aa16a9c6a6a9c9ca1a19c9c9ca19e9ea19ebb9c9c9c9c9c9cbcbcbcbcbcbcbc9c9cbc9c6a6aa19e6a6a9c6a9c9c9c9c9c9c9c9c9c9c9c9c9c9c6a9c9c9c9c9c9c9c9c9c9c9c9cbc9c9cbcbc9cbc9cbc9c9cbc9c9c6aa10000000001002f0006005da7a7a7a75d5d5d5d5d5da75d5da7a7a1a1a7a7a7a7ae055d5d6aa19cbcbcbcbcbcbcbcbbbbbbbbbbbcad9c9c30535da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a75d5d5da7a7a15da15da7a75da7a7a7a7ae97a7a7a75d5da1a1a1a1a1a16aa1a1a1a15d5d5da75d5d5d5da75d5d5da1a1a1a1a16aa16aa1a1a1a1a1a1a1a1a1a15d5d5d5d5d5da15d5da76a6a6a6a6a9c9c9ca1a1a15d5d5d5d5d5d5d5d5da1a16a9c9e6a9c9c9c6a6a9c9c9c9c9c9c9c9c9c9c9c9c6a9e9e9ea19c6a9ea1a16aa16a9c6a6a9c9ca1a19c9c9ca19e9ea19ebb9c9c9c9c9c9cbcbcbcbcbcbcbc9c9cbc9c6a6a6aa19e6a6a9c6a9c9c9c9c9c9c9c9c9c9c9c9c9c9c6a9c9c9c9c9c9c9c9c9c9c9c9cbc9c9cbcbc9cbc9cbc9c9cbc9c9c6aa1
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5143, caller 01e7:2819, values: 0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5145, caller 01e7:2832, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5146, caller 01e7:284b, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5147, caller 01e7:2765, values: 0001
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5149, caller 01e7:277e, values: 6800
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:514b, caller 01e7:2797, values: 94080000
DOS file read from file 5 (RESOURCE.MCS) bytes read 2196 to address: 044f:0000, caller 01e7:2800, values: 010001000000000000000a000b0b0c0c0d0d0c0c0301030000000000010033000e00a1a1a124a1242453a1a15353a1a1a153a1a1a1a1a1a18e53a18e8e438e433d3d43434343adbbbbbbbbbbbbbbbb61bbbbbbbb959ea1a15d5da75da15da7a1a1a1a1244343a143a7a7a7a7a7a7a7a75da7a1a75d5da1a15da15da15da1a1a1245da7a7a7a75d53a7a7a7a7a75da75da1a1a16a9c6a6a9c9c9c9ca16a9c6a6aa16a6a6aa1a1a1a1a1a1a1a1a1a15da7a7a7a7a7a7a7a7a7a75da19e9ea1a1a1a15d5d5da1a1a1a19ea1a19ea1a1a1a1a1a15da1a1a1a19ea19ea1a1a15da1a1a15da7a7a797a7a7a7a7a7a7a75d9ea15d5da1a1a15da1a15d5d5da1a19ea1a15d5da1a75d5da15d5da7a7a1a7a7a7a7a7a79797a797a797979d9d9797a7a797a79e9ea1a15da15da1a1a1a15da1a7a75d5da1a1a15d5da15da15da15d5da75d5d5da15d5d9797a7a79797a7a79797a7a7a7a75d4f626fa1a1a1a1a1a1a1a1a15d5da7a75d5da15d5da15da1a1a1a1a15da7a1a15da7a797979797a7a797a7a7a7a7a7a7a7a7a78d8d8d8d5a4f626fa1a1a1a1a15da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7979797977a7a9797a7a7a7a7a7a7a7a75da6a6a6a6a6a6a6a6a6a65a529d9d9797a7a7a7a7a797979797a797a7a797a7a7a7a7a7a79d7a449d9d9d9d9797979797a7a75dafaf67676767afafaf6fafa6447a44447a447a7a44447a449d7a9d449d97a7a7a7979d44449d7a7a7a9d9d9d979d9d9d9797a7af67afafafafafaf6faf67a69d9d9d7a7a9d9d44447a7a7a7a7a7a449d7a9d9d9d9d9d9d9d97979d9d979797979797979797a7afaf676767afaf6fafaf67a69d7a9d9d9d9d7a7a447a447a9d7a447a447a449d7a9d7a209d7a7a447a7a7a9d9d9d9d9d9797b5afafafafafaf6fafafaf67a69d7a9d9d9d9d44449d9d9d4444449d449d9d9d9d9d9d9d9d9797979797979d9d9d979d9d97b3af6f6f6f6f6f6fafaf67af67a69d7a9d447a9d447a7a7a447a447a44447a7a7a447a7a9d9d97979d9d9d9d9d9d9d9d979d73a8bc00000000010033000e00a1a1a124a1242453a1a15353a1a1a153a1a1a1a1a1a18e53a18e8e438e433d3d43434343adbbbbbbbbbbbbbbbb61bbbbbbbb959ea1a15d5da75da15da7a1a1a1a1244343a143a7a7a7a7a7a7a7a75da7a1a75d5da1a15da15da15da1a1a1245da7a7a7a75d53a7a7a7a7a75da75da1a1a16a9c6a6a9c9c9c9ca16a9c6a6aa16a6a6aa1a1a1a1a1a1a1a1a1a15da7a7a7a7a7a7a7a7a7a75da19e9ea1a1a1a15d5d5da1a1a1a19ea1a19ea1a1a1a1a1a15da1a1a1a19ea19ea1a1a15da1a1a15da7a7a797a7a7a7a7a7a7a75d9ea15d5da1a1a15da1a15d5d5da1a19ea1a15d5da1a75d5da15d5da7a7a1a7a7a7a7a7a79797a797a797979d9d9797a7a797a79e9ea1a15da15da1a1a1a15da1a75d5da1a1a15d5da15da15da15d5da75d5d5da15d5d9797a7a79797a7a79797a7a7a7a7a75d4f626fa1a1a1a1a1a1a1a1a15d5da7a75d5da15d5da15da1a1a1a1a15da7a1a15da7a797979797a7a797a7a7a7a7a7a7a7a7a78d8d8d8d5a4f626fa1a1a1a1a15d5da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7979797977a7a9797a7a7a7a7a7a7a75da6a6a6a6a6a6a6a6a6a65a529d9d9797a7a7a7a7a797979797a797a7a797a7a7a7a7a7a79d7a449d9d9d9d9797979797a7a75dafaf67676767afafaf6fafa6447a4444447a7a44447a449d7a9d449d97a7a7a7979d44449d7a7a7a9d9d9d979d9d9d9d9797a7af67afafafafafaf6faf67a69d9d9d7a7a9d9d44447a7a7a7a7a7a449d7a9d9d9d9d9d9d9d97979d9d979797979797979797a7afaf676767afaf6fafaf67a69d7a9d9d9d9d7a7a447a447a9d7a447a447a449d7a9d7a209d7a7a447a7a7a9d9d9d9d9d9797b5afafafafafaf6fafafaf67a69d7a9d9d9d9d44449d9d9d4444449d449d9d9d9d9d9d9d9d9797979797979d9d9d979d9d97b3af6f6f6f6f6f6fafaf67af67a69d7a9d447a9d447a7a7a447a447a44447a7a7a447a7a9d9d97979d9d9d9d9d9d9d9d979d73a8bc00000000010033000e00a1a1a124a1242453a1a15353a1a1a153a1a1a1a1a1a18e53a18e8e438e433d3d43434343adbbbbbbbbbbbbbbbb61bbbbbbbb959ea1a15d5da75da15da7a1a1a1a1244343a143a7a7a7a7a7a7a7a75da7a1a75d5da1a15da15da15da1a1a1245da7a7a7a75d53a7a7a7a7a75da75da1a1a16a9c6a6a9c9c9c9ca16a9c6a6aa16a6a6aa1a1a1a1a1a1a1a1a1a15da7a7a7a7a7a7a7a7a7a75da19e9ea1a1a1a15d5d5da1a1a1a19ea1a19ea1a1a1a1a1a15da1a1a1a19ea19ea1a1a15da1a1a15da7a7a797a7a7a7a7a7a7a75d9ea15d5da1a1a15da1a15d5d5da1a19ea1a15d5da1a75d5da15d5da7a7a1a7a7a7a7a7a79797a797a797979d9d9797a7a797a79e9ea1a15da15da1a1a1a1a15da1a75d5da1a1a15d5da15da15da15d5da75d5d5da15d5d9797a7a79797a7a79797a7a7a7a75d4f626fa1a1a1a1a1a1a1a1a15d5da7a75d5d5da15d5da15da1a1a1a1a15da7a1a15da7a797979797a7a797a7a7a7a7a7a7a7a78d8d8d8d5a4f626fa1a1a1a1a15da7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a797a7a7a7979797977a7a9797a7a7a7a7a7a7a7a75da6a6a6a6a6a6a6a6a6a65a529d9d9797a7a7a7a7a7a797979797a797a7a797a7a7a7a7a7a79d7a449d9d9d9d9797979797a75dafaf67676767afafaf6fafa6447a44447a447a7a44447a449d7a9d449d97a7a7a7979d44449d7a7a7a9d9d9d979d9d9d9797a7af67afafafafafaf6faf67a69d9d9d7a7a9d9d44447a7a7a7a7a7a449d7a9d9d9d9d9d9d9d97979d9d979797979797979797a7afaf676767afaf6fafaf67a69d7a9d9d9d9d7a7a447a447a9d7a447a447a449d7a9d7a209d7a7a447a7a7a9d9d9d9d9d9797b5afafafafafaf6fafafaf67a69d7a9d9d9d9d44449d9d9d4444449d449d9d9d9d9d9d9d9d9797979797979d9d9d979d9d97b3af6f6f6f6f6f6fafaf67af67a69d7a9d447a9d447a7a7a447a447a44447a7a7a447a7a9d9d97979d9d9d9d9d9d9d9d979d73a8bc
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5153, caller 01e7:2819, values: 0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5155, caller 01e7:2832, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5156, caller 01e7:284b, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5157, caller 01e7:2765, values: 1601
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5159, caller 01e7:277e, values: a200
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:515b, caller 01e7:2797, values: 06120000
DOS file read from file 5 (RESOURCE.MCS) bytes read 4614 to address: 0457:0000, caller 01e7:2800, values: 010001000000000000000a000b0b0c0c0d0d0dc0c03010300
000000000100280026001b1b1b1b78097878781b1b781b1b0b090b1b1b09010b787878787878783f9ebcbc9e9e9e9e9e9e9e781b09781b091b09780b09090909781b01091b7878090978091b1b781b9e5d5da79e9e9ebc9e9e9e7878a309090909780109090b1b09781b781b1b0909781b091b781b7878a7a7a7a7a7a7a7a7a7a7a7090b01090b0101090b01010909091b09017809090978781b097809783fa7a7a7a7a7a7a7a7a7a7a7090909090909097809091b78091b07781b097878781b071b78787878bc5da75da7a7a7a75dbcbcbc0b0b090b780978787809780b091b0b780b090978090901780b7809789ea77ba77ba7a19e9e9e9e9e090901787809787878097878090909787878780909090978017878075da7a77b9ebcbcbcbcbcbcbc780901090978781b0b0909097878091b0901780909787878780978467ba75d9ebcbca4a4a4bcbc9e0109097801090978780909010178781b0b780b0909010b0b787801bcbc9e9ebcbcbca4a4bcbcbcbc78780912097878787878090909780978787878090978787878783fbcbc9ebcbcbcbcbcbcbcbca47c09091b0978787878780b0b0909091b09090b7809097809091b7807bcbcbcbc9e9e9e9e9e9e9e9e9e1b091b1b1b1b951b78091b1b781b3f1b1b1b1b1b1b1b78070978a49e9e9e9e9e9e9e9ebcbcbcbcbc0b78780b7809787809097809091b09780909090909781b787878bca4bc9e9ebcbcbcbcbcbcbcbc9e090b0109780978780909780909090b78017878097809017878a4bc9e9ebc7ca4bcbcbcbcbcbcbcbc787878090978781b78787809781b781b787878090b1b78783fbc9e7ca4bc9e9e5da1a1a7a75da1a10b09097809097809090978780178781b097878090b78781ba4464646bcbcbc9e9e9e9e5d5d5d5d5d090109090978097809010909090109787878780909782e1ba44664bc9e5d5d5d5d5da7a7a7a7979709781b787209787878097878091209097878091b7878787846649e5da15da1a19ea1a7a7a7a7a15d1b0978091b78077878097809781b3f1b09787878787878bcbc9ea7a7a7a75da7a7a7a797a7a75da10b09780b7809090b090978090978090909090909090b78a1a1a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7090b0178780978780909780909090b787878010b090b7ca7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7787878090909781b78787809091b091b78780b0b013fa7a7a7a7a7a7a7a75d9ea7a7a7a7a7a7a7a70b0b017878091b09090109787878787809090b0b09a1a7a7a7a7a75d5d5d9e5d5da7a7a7a79ebcbc090b0909097809787801090909010978780b0b0995a7a7a7a7a7a7a7a7a7a7a7a7a75d9e9e9e9e9e097878787809787878787878090109090109780953a7a7a7a7a7a7a7a75da75d5d9ebcbcbcbcbc9e7809780978781b0978097809091b1b12090b097c5d5da1a15d5d5da19e9e9e9e9ebcbca47ca4bcbc78090b0b097809010b0978010909780b0b0b019e9e9e9ebcbc9e5d9ebcbcbcbcbcbcbca4a4a4bcbc09010b0978787878780909090909780b0b787cbcbcbcbcbcbcbc9e9e9ebcbcbcbcbcbcbcbcbcbcbc787878090909781b787878090909090b0b099e9e9e9e9e9e9e9e9e9e9ebcbcbc9e9e9e9e9e9e9e9e0b0b017878091b09090101017878010b0bbc9e9e9e9e9e9e9e9e9e9e9ebcbc9e9e9e9e9ebcbcbcbc09090978097809787809090978090b0b789e9e9e9e9e9e9e9e9e9e9e9ebc9e9ebcbcbcbcbcbc9ebc01780909090978017878097809010b01bc9e9e9e9e5d5d9e9e9e9e9e9e9ebc7ca4bcbc9ebcbcbc9e0b787809787878090b780b780b0b0b9c9e9ea15da7a7a7a7a7a75d5dbca4bc9e9e9e9e9e5d5da19e1b09780109780901017809780b012ea75d5d5da7a7a7a7a75d9e9ebcbcbcbcbc9e9e9e9e5da7a7a709010909780978787878090b0b0b53a75d5da7a75da7a1bc9ebcbcbc9e9e9e9e9e5d5da7a79797a70978780b0909097878780b0b0bbca7a7a7a77ba79e9ebc9ebcbc9e9e9e9e9e9ea19ea1a7a7a7a7a7780901787878781b9e9ea77ba79e9ea79e9ebcbcbcbcbcbc9e9e9e9e9ea15d5da7a7a7a79797a75dbcbcbcbcbcbc9ebcbca4bca4a4bcbcbcbcbcbcbcbcbcbca4a4bca4bcbc9e9ea1a7a7a7a7a7a7a7a7
000000000100280026001b1b1b1b78097878781b1b781b1b0b090b1b1b09010b787878787878783f9ebcbc9e9e9e9e9e9e9e781b09781b091b09780b09090909781b01091b7878090978091b1b781b9e5d5da79e9e9ebc9e9e9e7878a309090909780109090b1b09781b781b1b0909781b091b781b7878a75da7a7a79ea75da7a7a7090b01090b0101090b01010909091b09017809090978781b097809783fa7a7a7a7a7a75da7a7a7a7090909090909097809091b78091b07781b097878781b071b78787878bc5da75da7a7a7a75dbcbcbc0b0b090b780978787809780b091b0b780b090978090901780b7809789ea75da7a7a7a75dbcbcbc9e090901787809787878097878090909787878780909090978017878075da7a77b9ebcbcbcbcbcbcbc780901090978781b0b0909097878091b0901780909787878780978467bbcbc9e9ebca4a4a4bcbc9e0109097801090978780909010178781b0b780b0909010b0b787801bcbcbcbc9ebcbca4a4bcbcbcbc78780912097878787878090909780978787878090978787878783fbcbc9ebcbcbcbcbcbcbcbca47c09091b0978787878780b0b0909091b09090b7809097809091b7807bcbcbcbc9e9e9e9e9e9e9e9e9e1b091b1b1b1b951b78091b1b781b3f1b1b1b1b1b1b1b78070978a49e9e9e9e9e9e9e9ebcbcbcbcbc0b78780b7809787809097809091b09780909090909781b787878bca4bcbcbcbcbcbcbcbcbc9e9e9e090b0109780978780909780909090b78017878097809017878a4bc9e9ebc7ca4bcbcbcbcbcbcbcbc787878090978781b78787809781b781b787878090b1b78783f4646bcbcbc9e9e9e9ea1a7a75da1a10b09097809097809090978780178781b097878090b78781ba4464646bcbcbc9e9e9e9e5d5d5d5d5d090109090978097809010909090109787878780909782e1ba44664bc9e5d5d5d5d5da7a7a7a7979709781b787209787878097878091209097878091b7878787846a7a7a7a75da7a7a7a797a7a75da15d1b0978091b78077878097809781b3f1b09787878787878bcbc9ea7a7a7a75da7a7a7a797a7a75da10b09780b7809090b090978090978090909090909090b78a1a1a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7090b0178780978780909780909090b787878010b090b7ca7a7a7a7a75d9ea7a7a7a7a7a7a7a7a7a7787878090909781b78787809091b091b78780b0b013fa7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a70b0b017878091b09090109787878787809090b0b09a1a7a7a7a7a75d5da7a75d9e5d9e9ea79ebcbc090b0909097809787801090909010978780b0b0995a7a7a7a7a7a75da75d5d9e5dbcbcbcbc9e9e9e09787878780978787878787809010909010978095da1a1a7a7a7a7a7a75da75d5d9ebcbcbcbcbc9e7809780978781b0978097809091b1b12090b097cbcbcbca15d5d5da19e9e9e9e9ebcbca47ca4bcbc78090b0b097809010b0978010909780b0b0b019ebcbcbcbcbc5d9ebcbcbcbcbcbcbca4a4a4a4bcbc09010b0978787878780909090909780b0b787cbcbcbcbcbcbcbc9e9e9ebcbcbcbcbcbcbcbcbcbcbc787878090909781b787878090909090b0b099e9e9e9e9e9e9e9e9e9ebc9e9e9ebcbcbcbcbc9e9e9e0b0b017878091b09090101017878010b0bbc9e9e9e9e9e9e9e9e9e9ebcbcbc9e9e9e9e9ebcbcbcbc09090978097809787809090978090b0b789e9e9e9e9e9e9e9e9e9e9e9e9ebcbcbcbcbcbcbcbc9ebc01780909090978017878097809010b01bc9e9e9e9e5d5d9e9e9e9e9e9e9ebc7ca4bcbc9ebcbcbc9e0b787809787878090b780b780b0b0b9c9ea7a7a7a7a75d9e9e9e9e9e9e9e9e9ebc7ca4bc5d5da19e1b09780109780901017809780ba4a4a45d5d5da7a7a7a7a75d9e9ebcbcbcbcbc9ea79ea1a7a7a7a70901090978097878787809a4a4a453a75d5d5da7a7a7a7a75d9e9ebcbcbcbcbc9e5da7a7a79797a70978780b09090978a4a45353a75d5d5da7a7a7a79e9ebc9ebcbc9e9e9e9e9e9ea19ea1a7a7a7a7a7780901a4bcbcbcbca4a4bca4bcbc9e9ea1a7a77ba79e9ebc9ebcbc9e9e9e9e9ea7a7a7a79797a75dbcbcbcbcbc9ebcbca4bca4a4bcbcbcbcbcbcbcbcbcbca4a4bca4bcbc9e9ea1a7a7a7a7a7a7a7a7a7
000000000100280026001b1b1b1b78097878781b1b781b1b0b090b1b1b09010b787878787878783f9ebcbc9e9e9e9e9e9e9e781b09781b091b09780b09090909781b01091b7878090978091b1b781b9e5d5da79e9e9ebc9e9e9e7878a309090909780109090b1b09781b781b1b0909781b091b781b7878a7a7a7a7a7a7a7a7a7a7a7090b01090b0101090b01010909091b09017809090978781b097809783fa7a7a7a75da7a7a7a7a7a7090909090909097809091b78091b07781b097878781b071b78787878bc5da7a75da7a7bc5dbcbcbc0b0b090b780978787809780b091b0b780b090978090901780b7809789ea77ba77ba7a19e9e9e9e9e090901787809787878097878090909787878780909090978017878075da7a77b9ebcbcbcbcbcbcbc780901090978781b0b0909097878091b0901780909787878780978467ba75d9ebcbca4a4a4bcbc9e0109097801090978780909010178781b0b780b0909010b0b787801bcbc9e9ebcbcbca4a4bcbcbcbc78780912097878787878090909780978787878090978787878783fbcbc9ebcbcbcbcbcbcbcbca47c09091b0978787878780b0b0909091b09090b7809097809091b7807bcbcbcbc9e9e9e9e9e9e9e9e9e1b091b1b1b1b951b78091b1b781b3f1b1b1b1b1b1b1b78070978a49e9ebcbcbcbcbcbcbcbc9e9ebc0b78780b7809787809097809091b09780909090909781b787878bca4bc9e9ebcbcbcbcbcbcbcbc9e090b0109780978780909780909090b78017878097809017878a4bc9e9ebc7ca4bcbcbcbcbcbcbcbc787878090978781b78787809781b781b787878090b1b78783f4646bcbcbc9e9e9e9ea1a7a75da1a10b09097809097809090978780178781b097878090b78781ba4464646bcbcbc9e9e9e9e5d5d5d5d5d090109090978097809010909090109787878780909782e1ba446bcbcbc9e9e9e9e5d5da7a7a7979709781b787209787878097878091209097878091b7878787846a79e5d5d5d5d5da7a7a7a7a75da15d1b0978091b78077878097809781b3f1b09787878787878bcbc9ea7a7a7a75da7a7a7a797a7a75da10b09780b7809090b090978090978090909090909090b78a1a1a7a79ea7a7a7a75da7a7a7a797a7a7090b0178780978780909780909090b787878010b090b7ca7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7a7787878090909781b78787809091b091b78780b0b013fa7a7a7a7a7a7a7a75d5da7a7a7a7a7a7a7a70b0b017878091b09090109787878787809090b0b09a1a7a7a7a7a7a75d5d9ebcbc5d9e9ea79ebcbc090b0909097809787801090909010978780b0b0995a7a7a7a7a7a7a75da75d5d9ebcbcbcbc9e9e9e097878787809787878787878090109090109780953a7a7a7a7a7a79e9e9e9e9ebc9ebcbcbcbcbc9e7809780978781b0978097809091b1b12090b097c5d5da1a15d5d5da19e9e9e9e9ebcbca47ca4bcbc78090b0b097809010b0978010909780b0b0b019ebcbcbcbcbc5d9ebcbcbcbcbcbcbca4a4a4a4bcbc09010b0978787878780909090909780b0b787cbcbcbcbcbcbcbc9e9e9ebcbcbcbcbcbcbcbc9e9e9e787878090909781b787878090909090b0b099e9e9e9e9ebc9e9e9e9e9e9ebc9ebcbc9e9ebcbcbcbc0b0b017878091b09090101017878010b0bbc9e9e9e9e9e9e9e9e9e9e9e9ebcbc9e9e9e9ebcbcbcbc09090978097809787809090978090b0b789e9e9e9e9e9e9e9e9e9e9e9ebc9e9ebcbcbcbcbcbcbcbc01780909090978017878097809010b01bc9e9e9e9e5d5d9e9e9e9e9e9e9ebc7ca4bcbc9ebcbcbc9e0b787809787878090b780b780b0b0b9c9ea7a7a7a7a75d9e9e9e5d5d9e9e9e9ebc7ca4bc5d5da19e1b09780109780901017809780b01a4a75d5d5da7a7a7a7a79e9e9e9e9e9e9e9e9e9ea1a7a7a7a75d09010909780978787878090ba4a453a75d5d5da7a7a7a75da75d9e9ebc5d9e9e9ea7a7a79797a7970978780b0909097878a4a4a453a75d5da7a7a7a79e9ebc5da7a7a7a7a75d9e9ea19ea1a7a7a7a7a778090178a4a4bcbca4a4bca4a4bcbc9ea1a7a77ba79e9ebc9ebcbc9e9e9e9e9ea7a7a7a79797a75dbcbcbcbcbcbcbcbca4a4bcbcbcbcbcbcbcbcbcbca4a4bca4bcbc9e9ea1a7a7a7a7a7a7a7a7a7a7a7
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5163, caller 01e7:2819, values: 0000
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5165, caller 01e7:2832, values: 00
DOS file read from file 5 (RESOURCE.MCS) bytes read 1 to address: 029f:5166, caller 01e7:284b, values: 00
# This is the position where it needs to be drawn
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5167, caller 01e7:2765, values: 6c00
DOS file read from file 5 (RESOURCE.MCS) bytes read 2 to address: 029f:5169, caller 01e7:277e, values: 0e00
DOS file read from file 5 (RESOURCE.MCS) bytes read 4 to address: 029f:516b, caller 01e7:2797, values: 34060000
# This here seems to be the flag
# Introducing line breaks below to see the different animation frames - The 000000000100 part seems to belong to each frame
# Guessing that at local offset 0x18 there is the amount of frames
DOS file read from file 5 (RESOURCE.MCS) bytes read 1588 to address: 045f:0000, caller 01e7:2800, values: 0100010000000000000005000b0c0d03010300
0000000001001b0013002d117a872d2d03112d1111031103036868686868555555555502554b5492af11686855685555555555024b4b4b6868684b4b554b554b55549292a092383835927a54554b4b4b4b4b024b4b4b6868681168114b05ac35b835323535929238927a54554b4b4b4b4b6842032d03114b05b654a735323535323232a19292353838927a54552d2d111111547eac6865353235353232a13535353532a1359292353592362d555e05ac115eb835353532a13235353532a1323535353538a14b11115405b6115eb8353535a13232353535a1323235353532a135112d117aa7ac1165b83535a13532323235a1353232353535a1383511366897a76e11a7b8359c3535323232a1353532323535a132383511111197a76e5492b89c35353532329c353535323235a1353238354b111197a7ac35b8a43535353232a1353535323232a13535323835112d1197af9235b832353535329c3535353532329c353535323835114b689d92afa0a338383535a43235353535329c323535353238354b116897a7ab2d11547a92a3383835353532a432323235353238354b2d4b97a7b64268024b4b4b68547a9292a392389235353532353511114b97a1ac4b4b4b4b4b4b68024b4b4b4b547a929292353535352d684b9724694b4b686855114b4b4b4b4b4b4b4b4b686868111155684b687a532768555555555511114b4b4b4b4b1111111168554b55684b
0000000001001b0013002d117a872d2d03112d1111031103036868686868555555555502554b5492af11686855685555555555024b4b4b6868684b4b554b554b55549292a092383835927a54554b4b4b4b4b024b4b4b6868681168114b05ac35b83532353592929238927a544b4b4b4b4b6842032d03114b05b654a73532353532323232a1929238387a54554b2d2d111111547eac6865353235353232329c35353532a192923535924b362d555e05ac115eb8353535329ca132353535a13235353538a14b4b11115405b6115eb8353535a1a132323535359c32353532a1354b112d117aa7ac1165b83535a1353532323235a132323535a135354b11366897a76e11a7b8359c353535323232a135323235a13235354b11111197a76e5492b89c3535353532329c35353232a1353235354b4b111197a7ac35b8a4353535323232a135353532359c353235354b112d1197af9235b83235353532329c35353535329c9c353235354b114b689d92afa0a33838353535a4323535353535a435353235354b4b116897a7ab2d4b547a9235a4383835353532a43235353535354b4b2d4b97a7b6424b024b4b4b4b4b547a9292a3389235353535356811114b97a1ac4b4b4b4b4b4b6868024b4b4b547a9292353535354b2d684b9724694b4b686855114b4b4b4b4b4b4b4b4b4b4b4b111168684b687a532768555555555511114b4b4b4b4b1111111168554b55684b
0000000001001b0013002d117a872d2d03112d1111031103036868686868555555555502554b5492af11686855685555555555024b4b4b6868684b4b554b554b55549292a09238383835927a544b4b4b4b4b024b4b4b6868681168114b05ac35b835323235359292927a54554b4b4b4b4b6842032d03114b05b654a735323235353232a1a135383838927a54552d2d111111547eac6865353232353532a135353532a1a1359292353592362d555e05ac115eb835353535a132353532a132323535353538a14b11115405b6115eb8353535a135323535a132323235353532a135112d117aa7ac1165b835359c9c3532359ca1323232353535a1383511366897a76e11a7b835359c35353235a1353232323535a132383511111197a76e5492353535a1353232a1353532323235a1353238354b111197a7ac35b835359c35353232a13532323232a13535323835112d1197af9235b8359c353535329c35353235359c353535323835114b689d92afa0a3383838353535a1353532359c353532353238354b116897a7ab2d1155547a9235a438353235359c353532353238354b2d4b97a7b64268024b4b55547a929235929c929235353532353511114b97a1ac4b4b4b4b4b4b68024b4b4b4b547a929292353535352d684b9724694b4b686855114b4b4b4b4b4b4b4b4b686868111155684b687a532768555555555511114b4b4b4b4b1111111168554b55684b
# I think the flag was the last animated thing, so probably that's all of them

	*/
}



void Macs2Engine::readResourceFile() {
	Common::File file;
	if (!file.open("RESOURCE.MCS"))
		error("readResourceFile(): Error reading MCS file");

	file.seek(0x23BE09);


	// file.read(data, 320 * 240);

	// uint8 b0 = data[0];

	_bgImageShip.create(320, 200, Graphics::PixelFormat::createFormatCLUT8());

	uint8* lengthData = new uint8[2];
	uint8* data = new uint8[320];

	// TODO: Consider if it can be that the data is more than this. Maybe the tooling of the engine can make bad calls and
	// try to RLE something which would be better not RLE encoded.

	for (int y = 0; y < 200; y++) {
		// TODO: Use the proper read function, it seems to be available
		file.read(lengthData, 2);
		uint16 length = lengthData[1] << 8 | lengthData[0];
		file.read(data, length);
		uint16 remainingPixels = 320;
		uint8* dataPointer = data;
		uint16 x = 0;
		while (remainingPixels > 0) {
			const uint8& value = dataPointer[0];
			dataPointer++;
			if (value != 0xF0) {
				_bgImageShip.setPixel(x, y, value);
				remainingPixels--;
				x++;
			}
			else {
				// We need to decode the RLE data
				const uint8& runlength = dataPointer[0];
				dataPointer++;
				const uint8& encodedValue = dataPointer[0];
				dataPointer++;
				for (int i = 0; i < runlength; i++) {
					_bgImageShip.setPixel(x++, y, encodedValue);
				}
				remainingPixels -= runlength;
			}
		}
	}

	// Load the palette
	file.seek(0x00248BCB);
	file.read(_pal, 256 * 3);

	// Adjust the palette
	for (int i = 0; i < 256 * 3; i++) {
		_pal[i] = (_pal[i] * 259 + 33) >> 6;
	}

	// return check_cast<uint8_t>((c * 259 + 33) >> 6);

	// Iterate over 0 to 199 for each row
	// Load the amount of bytes for the row
	// Load the row data and do run-length decoding
	// Save into the right row of the surface


	// Load the data for a character

	file.seek(0x6FB2);
	_charASCII = file.readByte();
	_charWidth = file.readUint16LE();
	_charHeight = file.readUint16LE();
	_charData = new byte[_charWidth * _charHeight];
	file.read(_charData, _charWidth * _charHeight);

	file.seek(0x00006DFE);
	// Load more characters
	for (int i = 0; i < numGlyphs; i++) {
		_glyphs[i].ReadFromeFile(file);
	}

	// Load the animation frames
	// TODO: Figure out how the game knows how many there are
	// TODO: Figure out why the frames are not saved sequentially
	file.seek(0x0009619E);
	for (int i = 0; i < 1; i++) {
		_animFrames[i].ReadFromeFile(file);
	}

	// Load the data for a border part
	// file.seek(0x64C6);
	file.seek(0x0000602A);

	_borderWidth = file.readUint16LE();
	_borderHeight = file.readUint16LE();
	_borderData = new byte[_borderWidth * _borderHeight];
	file.read(_borderData, _borderWidth * _borderHeight);

	// And the highlight part
	file.seek(0x6962);
	

	_borderHighlightWidth = file.readUint16LE();
	_borderHighlightHeight = file.readUint16LE();
	_borderHighlightData = new byte[_borderHighlightWidth * _borderHighlightHeight];
	file.read(_borderHighlightData, _borderHighlightWidth * _borderHighlightHeight);

	// The flag animation frames
	file.seek(0x00250D47);
	_flagData = new byte * [3];
	_flagWidths = new uint16[3];
	_flagHeights = new uint16[3];
	_flagWidths[0] = file.readUint16LE();
	_flagHeights[0] = file.readUint16LE();
	_flagData[0] = new byte[_flagWidths[0] * _flagHeights[0]];
	file.read(_flagData[0], _flagWidths[0] * _flagHeights[0]);

	file.seek(0x00250B3C);
	_flagWidths[1] = file.readUint16LE();
	_flagHeights[1] = file.readUint16LE();
	_flagData[1] = new byte[_flagWidths[1] * _flagHeights[1]];
	file.read(_flagData[1], _flagWidths[1] * _flagHeights[1]);

	file.seek(0x00250931);
	_flagWidths[2] = file.readUint16LE();
	_flagHeights[2] = file.readUint16LE();
	_flagData[2] = new byte[_flagWidths[2] * _flagHeights[2]];
	file.read(_flagData[2], _flagWidths[2] * _flagHeights[2]);

	
	readBackgroundAnimations(0x0024C034, file);

	// Load the script
	file.seek(0x000A3B98);
	uint16 scriptLength = file.readUint16LE();
	_scriptData = new byte[scriptLength];
	file.read(_scriptData, scriptLength);
	_scriptStream = new Common::MemoryReadStream(_scriptData, scriptLength);

	// Load the strings for the scene
	file.seek(0x000D2F22);
	numBytesStrings = file.readUint16LE();
	stringsData = new byte[numBytesStrings];
	file.read(stringsData, numBytesStrings);
	_stringsStream = new Common::MemoryReadStream(stringsData, numBytesStrings);


	// Try executing the script
	ExecuteScript(_scriptStream);

	// Load the background map
	// _map = readRLEImage(0x0024BD9B, file);
	// _map = readRLEImage(0x00248FCE, file);
	// Next on is the actual map
	// _map = readRLEImage(0x0024B0DF, file);
	// TODO: This is the depth map - TBC that it's actually it
	_map = readRLEImage(0x00248FCE, file);
	

	// Load the data for the mouse cursor

	// TODO: Figure out which is the correct one
	// file.seek(0x00003C74);
	// file.seek(0x0000524A);
	file.seek(0x000050EC);
	constexpr int numCursors = 5;
	_cursorData = new byte *[numCursors];
	_cursorWidths = new uint16[numCursors];
	_cursorHeights = new uint16[numCursors];
	for (int i = 0; i < numCursors; i++) {
		_cursorWidths[i] = file.readUint16LE();
		_cursorHeights[i] = file.readUint16LE();
		_cursorData[i] = new byte[_cursorWidths[i] * _cursorHeights[i]];
		file.read(_cursorData[i], _cursorWidths[i] * _cursorHeights[i]);
		// Seek forward to skip an entry
		// TODO: Figure out what is skipped there
		file.seek(0x6, SEEK_CUR);
	}


	// Load a frame of animation from the protagonist
	// Crawling towards the left
	// file.seek(0x000C95A8);
	// Standing towards the right
	// file.seek(0x001CC5D9);
	// Also standing towards the right
	// file.seek(0x000D0B26);

	file.seek(0x006AB0FD);
	

	_guyWidth = file.readUint16LE();
	_guyHeight = file.readUint16LE();
	_guyData = new byte[_guyWidth * _guyHeight];
	file.read(_guyData, _guyWidth * _guyHeight);

	// Load the shading table
	file.seek(0x00248ECB);
	_shadingTable = new byte[256];
	file.read(_shadingTable, 256);

	
	// Load the objects data
	file.seek(0x6a5913);

	// Load the stick
	file.seek(0x00708410);
	_stick.ReadFromeFile(file);
}

Macs2Engine::Macs2Engine(OSystem *syst, const ADGameDescription *gameDesc) : Engine(syst),
	_gameDescription(gameDesc), _randomSource("Macs2") {
	g_engine = this;
}

Macs2Engine::~Macs2Engine() {


}

bool Macs2Engine::FindGlyph(char c, GlyphData &out) const {
	for (int i = 0; i < numGlyphs; i++) {
		if (_glyphs[i].ASCII == c) {
			out = _glyphs[i];
			return true;
		}
	}
	return false;
}

// Does what 9F23 does
uint16 ScriptReadWord(Common::MemoryReadStream* stream) {
	const int64 pos = stream->pos();
	const uint16 result = stream->readUint16LE();
	debug("Script read (word): %.4x at offset %.4x\n", result, pos);
	return result;
}

// Does pretty much what 9F07 does
byte ScriptReadByte(Common::MemoryReadStream* stream) {

	const int64 pos = stream->pos();
	const byte result = stream->readByte();
	debug("Script read (byte): %.2x at offset %.4x\n", result, pos);
	return result;
}

// #define ScriptNoEntry assert(false);
#define ScriptNoEntry debug("Unhandled case in script handling");

void Func9F4DClean(Common::MemoryReadStream *stream, uint16 &out1, uint16 &out2) {
	// TODO: Implement the actual prelude here correctly, documenting which lables we pass as we go
	debug("-- Entering 9F4D");


	/*
		;; Make space for Ch bytes
	;; Note: I don't think this has any inputs, but it does have some state since it returns different (hotspots?)
	;; if called repeatedly
	enter	0Ch,0h
	;; This function has some internal state and iterates over some list
	call	far 0037h:9F07h
	;; For the analysis of the call that returns the correct active hotspot, it returns 1100h, of which only the AL part is taken
	mov	[bp-5h],al
	;; Note: This call will return the right hotspot value
	call	far 0037h:9F23h
	mov	[bp-7h],ax
	cmp	byte ptr [bp-5h],0h
	jnz	9F72h
	*/







	debug("-- Leaving 94FD");
}

void Func9F4D(Common::MemoryReadStream * stream, uint16& out1, uint16& out2) {
	debug("-- Entering 9F4D");
	// Read an opcode (would be 0037:9F07) - [bp-1h]
	byte opcode = ScriptReadByte(stream);
	// debug("Script read (byte): %.2x at offset %.4x\n", opcode, stream->pos());

	uint16 value = ScriptReadWord(stream);

	// TODO: Add the "prelude" before the big switch here, since the logic is more general than what I would implement if I took it case by case

	// debug("Script read (word): %.4x at offset %.4x\n", value, stream->pos());
	// TODO: There is some code required here to follow the logic exactly of going from opcode 1 to 2
	if (opcode == 0x00) {
		// l0037_9F67:
		// TODO: Confirm that nothing else will be done in this case
		out1 = value;
		out2 = 0;
		debug("-- Leaving 94FD");
		return;
	}
	if (opcode == 0x01) {
		if (value == 0x0b) {
			// TODO: Hardcoded combination, the rule is more general
			out1 = 0x03;
			out2 = 0x00;
			debug("-- Leaving 94FD");
			return;
		}
	} else
	if (opcode == 0x02) {
		// TODO: We need to start handling opcode2 in this case
		if (value == 0x0a) {
			// TODO: This is too verbatim, only to get me to pass the script once. In reality, we are accessing a saved variable in this and similar cases based on the second value
			out1 = 0;
			out2 = 0;
			debug("-- Leaving 94FD");
			return;
		}
	}
	else
	if (opcode == 0xFF) {
		if (value == 0x02) {
			// TODO: Look up clicked hotspot instead
			out1 = 0x0801;
			out2 = 0x0000;
			return;
		} else
		// TODO: Long list of opcode handling here
		if (value == 0x26) {
			// TODO: Implement this part:
	/* l0037_A19E:
		cmp	byte ptr[1014h], 0h
			jz	0A1B1h

			l0037_A1A5 :
		mov	word ptr[bp - 4h], 1h
			mov	word ptr[bp - 2h], 0h
			jmp	0A1B9h

			l0037_A1B1 :
		xor ax, ax
			mov[bp - 4h], ax
			mov[bp - 2h], ax */

			// For now just returning 0 by default
			out1 = 0;
			out2 = 0;
			debug("-- Leaving 94FD");
			return;
		}
	}
	else {
		ScriptNoEntry
	}
}



void FuncA3D2(Common::MemoryReadStream* stream) {
	debug("-- Entering A3D2");
	uint16 skipValue = 1; // [bp-4h] - TODO: Better name
	// TODO: Figure out end condition
	for (;;) {
		const byte opcode = ScriptReadByte(stream);
		const byte val = ScriptReadByte(stream);
		if (opcode >= 3) {
			if (opcode <= 6) {
				skipValue++;
			}
		}
		if (opcode == 8) {
			if (skipValue == 1) {
				skipValue--;
			}
		}
		if (opcode == 7) {
			skipValue--;
		}
		// Do the skipping
		stream->seek(val, SEEK_CUR);
		debug("A3D2 skipping %u bytes for opcode %.2x (%u)", val, opcode, skipValue);
			
		// TODO: Add a log here
		if (skipValue != 0) {
			// Continue the loop if there is data left in the stream
			// TODO: Check for remaining script data
		}
		else {
			if (skipValue != 0) {
				// TODO: Implement:
				// mov	word ptr [1028h],1Dh
				// TODO: Add an assert here to see if this ever happens in practice
			}
			break;
		}
		// TODO: Continue here
	}
	debug("-- Leaving A3D2");
}


void Macs2Engine::PlaySound() {
	OPL::OPL *_opl = OPL::Config::create();
	int status = _opl->init();
	
	#define CALLBACKS_PER_SECOND 10
	_opl->start(new Common::Functor0Mem<void, Macs2Engine>(this, &Macs2Engine::OnTimer), CALLBACKS_PER_SECOND);
	// _opl->write(0x388, 0x00);
	/*  _opl->writeReg(0x388, 0xA0);
	_opl->writeReg(0x389, 0x36);
	_opl->writeReg(0x388, 0x20);
	_opl->writeReg(0x389, 0x20); */
	// initialize();
	_opl->writeReg(0x20, 0x01);
	_opl->writeReg(0x40, 0x10);
	_opl->writeReg(0x60, 0xF0);
	_opl->writeReg(0x80, 0x77);
	_opl->writeReg(0xA0, 0x98);
	_opl->writeReg(0x23, 0x01);
	_opl->writeReg(0x43, 0x00);
	_opl->writeReg(0x63, 0xF0);
	_opl->writeReg(0x83, 0x77);
	// _opl->writeReg(0xB0, 0x31);

	/*
	    REGISTER     VALUE     DESCRIPTION
 |        20          01      Set the modulator's multiple to 1
 |        40          10      Set the modulator's level to about 40 dB
 |        60          F0      Modulator attack:  quick;   decay:   long
 |        80          77      Modulator sustain: medium;  release: medium
 |        A0          98      Set voice frequency's LSB (it'll be a D#)
 |        23          01      Set the carrier's multiple to 1
 |        43          00      Set the carrier to maximum volume (about 47 dB)
 |        63          F0      Carrier attack:  quick;   decay:   long
 |        83          77      Carrier sustain: medium;  release: medium
 |        B0          31      Turn the voice on; set the octave and freq MSB
 |
 |   To turn the voice off, set register B0h to 11h (or, in fact, any value 
 |   which leaves bit 5 clear).  It's generally preferable, of course, to
 |   induce a delay before doing so.
 |*/
}

void Macs2Engine::OnTimer() {
}


void Macs2Engine::NextCursorMode() {
	if (_cursorMode == CursorMode::Walk) {
		_cursorMode = CursorMode::Talk;
	} else {
		_cursorMode = static_cast<CursorMode>(static_cast<int>(_cursorMode) + 1);
	}
}

void Macs2Engine::ScriptPrintString(Common::MemoryReadStream *stream) {

	// TODO: Labels above not handled yet
	// TODO: Lots of details not handled
	// l0037_A94E:

	uint16_t v1;
	uint16_t v2;
	Func9F4D(stream, v1, v2);
	uint16_t v3;
	uint16_t v4;
	Func9F4D(stream, v3, v4);
	// TODO: Several globals writes around this code
	uint16_t bp2 = ScriptReadWord(stream);
	uint16_t bp4 = ScriptReadWord(stream);

	// TODO: Implement naive string printing here, refine later
	Common::StringArray strings = DecodeStrings(_stringsStream, bp2, bp4);
}

void Macs2Engine::ExecuteScript(Common::MemoryReadStream *stream) {
	PlaySound();

	// Implements roughly 01E7:DB56 and friends
	// TODO: Change to a proper end condition
	// TODO: Do some bookkeeping on the pointers into the script
	for (;;) {
		

		// l0037_DB89:


		// Read an opcode (would be 0037:9F07) - [bp-1h]
		byte opcode1 = ScriptReadByte(stream);

		// Read another value - TODO: Not sure yet what this does - [bp-2h]
		byte val1 = ScriptReadByte(stream);

		// TODO: Handle other opcodes above
		if (opcode1 == 0x01) {
			ScriptReadByte(stream);
			ScriptReadWord(stream);
			uint16 result1;
			uint16 result2;

			Func9F4D(stream, result1, result2);
			// TODO: Implement properly - this looks like some kind of bookkeeping since it doesn't determine if we continue or not?
				/*
				call	far 0037h:9F07h
				call	far 0037h : 9F23h
				mov[bp - 11h], ax
				call	far 0037h : 9F4Dh
				mov	cx, ax
				mov	bx, dx
				mov	ax, [bp - 11h]
				shl	ax, 2h
				les	di, [06C6h]
				add	di, ax
				mov	es : [di - 4h] , cx
				mov	es : [di - 2h] , bx
				// This jumps ahead to the end of the loop
				jmp	0E3BAh
				*/
		}
		else if (opcode1 == 0x02 || opcode1 == 0x03) {
			// TODO: Implement
			ScriptNoEntry
		} else
		if (opcode1 == 0x04) {
			// l0037_DC44:
			uint16 v1;
			uint16 v2;
			Func9F4D(stream, v1, v2);
			if ((v1 | v2) == 0) {
				FuncA3D2(stream);
			}
			else {
				// TODO: Implement
				ScriptNoEntry
			}
		}
		else if (opcode1 == 0x05) {
			// TODO: Implement this second opcode fetching:
			// [bp-3h]
			byte opcode2 = ScriptReadByte(stream);

			// [bp-7h]
			uint16 v1;
			// [bp-5h]
			uint16 v2;
			Func9F4D(stream, v1, v2);
			// [bp-0Bh]
			uint16 v3;
			// [bp-9h]
			uint16 v4;
			Func9F4D(stream, v3, v4);
			// TODO: Not yet implemented:
			// mov	byte ptr [bp-12h],0h

			bool bp12 = false; // [bp-12h] - TODO: Better name

			if (opcode2 == 0x01) {
			// l0037_DC8F:;
				// TODO Cntinue here
				if (v2 == v4 && v1 == v3) {
					bp12 = true;
				}
			} else {
				ScriptNoEntry
			}

			// TODO: Check if we can reach this label also from the other opcodes
			// l0037_DD2E:
			if (!bp12) {
				// Skip ahead
				FuncA3D2(stream);
			}

			
		}
		// This is where handling of the opcodes > 6 continues
		// TODO: Does it really? To check if I got this right
		// l0037_DD3C
		else if (opcode1 == 0x06) {
			ScriptNoEntry
		}
		else if (opcode1 == 0x07) {
			ScriptNoEntry
		} else if (opcode1 == 0x10) {
			// TODO: Confirm that this code is being hit
		/*  l0037_DE6E:
			cmp al, 10h jnz 0DE7Ah

				l0037_DE72 : call far 0037h : 0B843h jmp 0E3BAh */
		} else if (opcode1 == 0x0a) {
			// TODO: Push 0
			ScriptPrintString(stream);
		}
		else {
			ScriptNoEntry
			break;
		}

		// TODO: Handle other opcodes below
		

		
	}
}

int Macs2Engine::MeasureString(Common::String& s) {
	int sum = 0;
	GlyphData currentGlyph;
	bool found = false;
	for (auto current = s.begin(); current != s.end(); current++) {
		if (*current == ' ') {
			// TODO: Check if we hit this one
			sum += 8 + 1;
		} else {
			found = FindGlyph(*current, currentGlyph);
			// TODO: Check if found
			sum += currentGlyph.Width + 1;
			// TODO: Check the rules for adding a 1
		}
	}
	return sum;
}

int Macs2Engine::MeasureStrings(Common::StringArray sa) {
	int max = -1;
	for (auto iter = sa.begin(); iter != sa.end(); iter++) {
		max = MAX(MeasureString(*iter), max);
	}
	return max;
}

Common::String Macs2Engine::DecodeString(Common::MemoryReadStream* stream, int offset, int numLines)
{
	stream->seek(offset);
	
	byte x;
	byte y;
	byte r;
	Common::String result;
	for (int i = 0; i != numLines; i++) {
		uint16 length = stream->readUint16LE();
		int index = 1;
		for (byte currentByte = stream->readByte(); index != length; currentByte = stream->readByte(), index++) {
			x = (byte)(index * index * 0x0c);
			y = (byte)(currentByte ^ index);
			r = (byte)(x ^ y);
			result += (char)r;
		}
	}
	
	return result;
}

Common::StringArray Macs2Engine::DecodeStrings(Common::MemoryReadStream *stream, int offset, int numStrings) {
	// TODO: Adjust to a non-seeking variant
	Common::StringArray result(numStrings);
	int64 pos = offset;
	/* for (int i = 0; i < numStrings; i++) {
		Common::String current = DecodeString(stream, pos);
		pos = stream->pos();
		result[i] = current;
	} */
	Common::String current = DecodeString(stream, pos, numStrings);
	return result;
}

uint32 Macs2Engine::getFeatures() const {
	return _gameDescription->flags;
}

Common::String Macs2Engine::getGameId() const {
	return _gameDescription->gameId;
}

Common::Error Macs2Engine::run() {

	readResourceFile();

	// Initialize 320x200 paletted graphics mode
	initGraphics(320, 200);

	

	// Set the engine's debugger console
	setDebugger(new Console());

	runGame();

	return Common::kNoError;
}

Common::Error Macs2Engine::syncGame(Common::Serializer &s) {
	// The Serializer has methods isLoading() and isSaving()
	// if you need to specific steps; for example setting
	// an array size after reading it's length, whereas
	// for saving it would write the existing array's length
	int dummy = 0;
	s.syncAsUint32LE(dummy);

	return Common::kNoError;
}

void GlyphData::ReadFromeFile(Common::File &file) {
	// TODO: Implement
	int64 stride = file.pos();
	ASCII = file.readByte();
	Width = file.readUint16LE();
	Height = file.readUint16LE();
	Data = new byte[Width * Height];
	file.read(Data, Width * Height);
	stride = file.pos() - stride;
}

void AnimFrame::ReadFromeFile(Common::File &file) {
	Width = file.readUint16LE();
	Height = file.readUint16LE();
	Data = new byte[Width * Height];
	file.read(Data, Width * Height);
}

bool AnimFrame::PixelHit(const Common::Point& point) const {
	// TODO: We are ignoring z painting for now
	if (point.x < 0 || point.x >= Width || point.y < 0 || point.y >= Height) {
		return false;
	}
	return Data[point.y * Width + point.x] != 0;
}

} // End of namespace Macs2

/*
private void TextBox_TextChanged(object sender, TextChangedEventArgs e)
		{
			string[] hexValuesSplit = InputTextBox.Text.Split(' ');
			string result = String.Empty;
			byte index = 1;
			foreach (string hex in hexValuesSplit)
			{
				byte value;
				// Convert the number expressed in base-16 to an integer.
				try
				{
					value = Convert.ToByte(hex, 16);
				}
				catch
				{
					return;
				}
				byte x = (byte)(index * index * 0x0c);
				byte y = (byte)(value ^ index);
				byte r = (byte)(x ^ y);
				result += (char)r;
				index++;
			}
			OutputTextBlock.Text = result;
		}

*/
